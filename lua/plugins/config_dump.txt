

--- FILE: /home/james/.config/nvim/ftplugin/java.lua ---
-- /home/james/.config/nvim/ftplugin/java.lua
-- === DEBUG STEP 1: See if this file is running ===
vim.notify("JDTLS ftplugin: Executing for " .. vim.api.nvim_buf_get_name(0), vim.log.levels.INFO, { title = "JDTLS" })

local home = vim.env.HOME
local jdtls = require("jdtls")

-- === ADDITION 1: Load spring-boot.nvim and init commands ===
local spring_boot_ok, spring_boot = pcall(require, "spring_boot")
if spring_boot_ok then
  spring_boot.init_lsp_commands()
  vim.notify("JDTLS ftplugin: spring-boot.nvim loaded", vim.log.levels.INFO, { title = "JDTLS" })
else
  vim.notify("JDTLS ftplugin: require('spring_boot') failed!", vim.log.levels.WARN, { title = "JDTLS" })
end
-- ==========================================================

if not jdtls then
  vim.notify("JDTLS ftplugin: require('jdtls') failed!", vim.log.levels.ERROR, { title = "JDTLS" })
  return
end

-- === DEBUG STEP 2: See what root_dir is found ===
local root_dir = require("jdtls.setup").find_root({ ".git", "mvnw", "gradlew", "pom.xml", "build.gradle" })

vim.notify("JDTLS ftplugin: Found root_dir: " .. tostring(root_dir), vim.log.levels.INFO, { title = "JDTLS" })

if root_dir == nil or root_dir == "" then
  vim.notify(
    "JDTLS ftplugin: No project root found. Attaching in single-file mode.",
    vim.log.levels.WARN,
    { title = "JDTLS" }
  )
  -- Attempt to attach in single-file mode
  root_dir = vim.fn.fnamemodify(vim.api.nvim_buf_get_name(0), ":h")
end

-- === Your Original Configuration Starts Here ===

local project_name = vim.fn.fnamemodify(root_dir, ":t")
local workspace_dir = home .. "/jdtls-workspace/" .. project_name

local system_os = vim.fn.has("mac") == 1 and "mac" or vim.fn.has("win32") == 1 and "win" or "linux"
local mason = home .. "/.local/share/nvim/mason/packages"

-- === BUNDLES (skip problematic JARs) ===
local bundles = {
  vim.fn.glob(mason .. "/java-debug-adapter/extension/server/com.microsoft.java.debug.plugin-*.jar", true),
}
local test_dir = mason .. "/java-test/extension/server"
local test_jars = vim.fn.glob(test_dir .. "/*.jar", true)
if test_jars ~= "" then
  for _, jar in ipairs(vim.split(test_jars, "\n")) do
    local name = vim.fn.fnamemodify(jar, ":t")
    if not (name:match("^com.microsoft.java.test.runner") or name:match("^jacocoagent")) then
      table.insert(bundles, jar)
    end
  end
end

-- === ADDITION 2: Add Spring Boot extensions to bundles ===
if spring_boot_ok then
  vim.notify("JDTLS ftplugin: Loading spring-boot.nvim extensions", vim.log.levels.INFO, { title = "JDTLS" })
  local spring_boot_extensions = spring_boot.java_extensions()
  vim.list_extend(bundles, spring_boot_extensions)
end
-- ========================================================

local config = {
  cmd = {
    "java",
    "-Declipse.application=org.eclipse.jdt.ls.core.id1",
    "-Dosgi.bundles.defaultStartLevel=4",
    "-Declipse.product=org.eclipse.jdt.ls.core.product",
    "-Dlog.protocol=true",
    "-Dlog.level=ALL",
    "-javaagent:" .. mason .. "/jdtls/lombok.jar",
    "-Xmx4g",
    "--add-modules=ALL-SYSTEM",
    "--add-opens",
    "java.base/java.util=ALL-UNNAMED",
    "--add-opens",
    "java.base/java.lang=ALL-UNNAMED",
    "-jar",
    vim.fn.glob(mason .. "/jdtls/plugins/org.eclipse.equinox.launcher_*.jar", true),
    "-configuration",
    mason .. "/jdtls/config_" .. system_os,
    "-data",
    workspace_dir,
  },

  root_dir = root_dir, -- Use the dynamically found root_dir

  settings = {
    java = {
      home = "/usr/lib/jvm/java-25-openjdk/",
      eclipse = { downloadSources = true },
      configuration = {
        updateBuildConfiguration = "interactive",
        runtimes = {
          { name = "JavaSE-21", path = "/home/james/.sdkman/candidates/java/21.0.8-tem/" },
          { name = "JavaSE-25", path = "/usr/lib/jvm/java-25-openjdk/" },
        },
      },
      maven = { downloadSources = true },
      spring = { boot = { enabled = true } },

      project = {
        outputPath = "target/classes", -- Maven
      },

      sourcePaths = {
        "src/main/java",
        "src/test/java",
      },

      -- Rest of your settings...
      implementationsCodeLens = { enabled = true },
      referencesCodeLens = { enabled = true },
      references = { includeDecompiledSources = true },
      signatureHelp = { enabled = true },
      format = { enabled = true },
      completion = {
        favoriteStaticMembers = {
          "org.hamcrest.MatcherAssert.assertThat",
          "org.hamcrest.Matchers.*",
          "org.hamcrest.CoreMatchers.*",
          "org.junit.jupiter.api.Assertions.*",
          "java.util.Objects.requireNonNull",
          "java.util.Objects.requireNonNullElse",
          "org.mockito.Mockito.*",
        },
        importOrder = { "java", "javax", "com", "org" },
      },
      sources = { organizeImports = { starThreshold = 9999, staticStarThreshold = 9999 } },
      codeGeneration = {
        toString = { template = "${object.className}{${member.name()}=${member.value}, ${otherMembers}}" },
        useBlocks = true,
      },
    },
  },

  capabilities = require("cmp_nvim_lsp").default_capabilities(),
  flags = { allow_incremental_sync = true },

  -- *** THIS IS THE FIX ***
  -- It was 'ind_options' before, which is a syntax error.
  init_options = {
    bundles = bundles, -- This 'bundles' table now includes the Spring Boot ones
    extendedClientCapabilities = jdtls.extendedClientCapabilities,
  },
}

-- === ON_ATTACH: DAP with proper source mapping ===
config.on_attach = function(client, bufnr)
  client.server_capabilities.semanticTokensProvider = nil
  -- This will be called for each buffer
  jdtls.setup_dap({ hotcodereplace = "auto" })

  require("jdtls.dap").setup_dap_main_class_configs({
    config_overrides = {
      vmArgs = "-Dspring.profiles.active=dev",
      sourcePaths = { "src/main/java", "src/test/java" },
    },
  })

  local opts = { buffer = bufnr, silent = true }
  vim.keymap.set("n", "<F5>", function()
    if require("dap").session() then
      require("dap").continue()
    else
      require("dap").continue()
    end
  end, opts)

  vim.keymap.set("n", "<leader>sb", function()
    require("jdtls.dap").runSpringBoot()
  end, opts)
end

-- This is the final, most important call.
-- This will run every time you open a java file.
jdtls.start_or_attach(config)


--- FILE: /home/james/.config/nvim/init.lua ---
-- bootstrap lazy.nvim, LazyVim and your plugins
require("config.lazy")


--- FILE: /home/james/.config/nvim/lua/config/autocmds.lua ---
-- Autocmds are automatically loaded on the VeryLazy event
-- Default autocmds that are always set: https://github.com/LazyVim/LazyVim/blob/main/lua/lazyvim/config/autocmds.lua
--
-- Add any additional autocmds here
-- with `vim.api.nvim_create_autocmd`
--
-- Or remove existing autocmds by their group name (which is prefixed with `lazyvim_` for the defaults)
-- e.g. vim.api.nvim_del_augroup_by_name("lazyvim_wrap_spell")


--- FILE: /home/james/.config/nvim/lua/config/keymaps.lua ---
-- Keymaps are automatically loaded on the VeryLazy event
-- Default keymaps that are always set: https://github.com/LazyVim/LazyVim/blob/main/lua/lazyvim/config/keymaps.lua
-- Add any additional keymaps here
--
vim.keymap.set("i", "<S-Tab>", "<C-d>", { desc = "Dedent line" })
vim.keymap.set("n", "<S-Tab>", "<<", { desc = "Dedent line" })
vim.keymap.set("v", "<S-Tab>", "<gv", { desc = "Dedent selection" })

-- Remove LazyVim's terminal binding
vim.keymap.del("n", "<C-/>")
vim.keymap.del("t", "<C-/>")

-- Comment with Ctrl+/ (works in terminal + GUI)
vim.keymap.set("n", "<C-/>", function()
  return vim.v.count == 0 and "gcc" or "gc"
end, { expr = true, desc = "Toggle comment", remap = true })

vim.keymap.set("v", "<C-/>", "gc", { desc = "Toggle comment", remap = true })

-- Fallback for terminals that send Ctrl+_
vim.keymap.set("n", "<C-_>", "gcc", { desc = "Toggle comment", remap = true })
vim.keymap.set("v", "<C-_>", "gc", { desc = "Toggle comment", remap = true })

-- Open terminal on Ctrl+\ (or any key you like)
-- Use built-in terminal (no plugin)
vim.keymap.set({ "n", "t" }, "<C-\\>", function()
  vim.cmd("botright 12split | terminal")
end, { desc = "Terminal" })

vim.keymap.set("t", "<Esc>", [[<C-\><C-n>]], { desc = "Escape terminal mode" })

-- Spring
-- Search Spring Beans, Endpoints, etc. using snacks.nvim
vim.keymap.set("n", "<leader>zb", function()
  require("snacks").picker({
    source = "lsp_workspace_symbols",
    prompt = "Spring Beans & Endpoints",
    query = "@Bean", -- optional: pre-fill with @Bean
  })
end, { desc = "Search Spring @Bean" })

-- General LSP symbols (includes Spring stuff)
vim.keymap.set("n", "<leader>zs", function()
  require("snacks").picker({
    source = "lsp_workspace_symbols",
    prompt = "LSP Symbols",
  })
end, { desc = "LSP Workspace Symbols" })

-- 3. Seamless Window Navigation
-- Jump from Terminal to Code using Ctrl + h/j/k/l
vim.keymap.set("t", "<C-h>", "<cmd>wincmd h<cr>", { desc = "Go to Left" })
vim.keymap.set("t", "<C-j>", "<cmd>wincmd j<cr>", { desc = "Go to Lower" })
vim.keymap.set("t", "<C-k>", "<cmd>wincmd k<cr>", { desc = "Go to Upper" })
vim.keymap.set("t", "<C-l>", "<cmd>wincmd l<cr>", { desc = "Go to Right" })


--- FILE: /home/james/.config/nvim/lua/config/lazy.lua ---
local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim"
if not (vim.uv or vim.loop).fs_stat(lazypath) then
  local lazyrepo = "https://github.com/folke/lazy.nvim.git"
  local out = vim.fn.system({ "git", "clone", "--filter=blob:none", "--branch=stable", lazyrepo, lazypath })
  if vim.v.shell_error ~= 0 then
    vim.api.nvim_echo({
      { "Failed to clone lazy.nvim:\n", "ErrorMsg" },
      { out, "WarningMsg" },
      { "\nPress any key to exit..." },
    }, true, {})
    vim.fn.getchar()
    os.exit(1)
  end
end
vim.opt.rtp:prepend(lazypath)

require("lazy").setup({
  spec = {
    -- add LazyVim and import its plugins
    { "LazyVim/LazyVim", import = "lazyvim.plugins" },
    -- import any extras
    { import = "lazyvim.plugins.extras.dap.core" },
    -- import/override with your plugins (must be last)
    { import = "plugins" },
  },
  defaults = {
    -- By default, only LazyVim plugins will be lazy-loaded. Your custom plugins will load during startup.
    -- If you know what you're doing, you can set this to `true` to have all your custom plugins lazy-loaded by default.
    lazy = false,
    -- It's recommended to leave version=false for now, since a lot the plugin that support versioning,
    -- have outdated releases, which may break your Neovim install.
    version = false, -- always use the latest git commit
    -- version = "*", -- try installing the latest stable version for plugins that support semver
  },
  install = { colorscheme = { "tokyonight", "habamax" } },
  checker = {
    enabled = true, -- check for plugin updates periodically
    notify = false, -- notify on update
  }, -- automatically check for plugin updates
  performance = {
    rtp = {
      -- disable some rtp plugins
      disabled_plugins = {
        "gzip",
        -- "matchit",
        -- "matchparen",
        -- "netrwPlugin",
        "tarPlugin",
        "tohtml",
        "tutor",
        "zipPlugin",
      },
    },
  },
})


--- FILE: /home/james/.config/nvim/lua/config/options.lua ---
-- Options are automatically loaded before lazy.nvim startup
-- Default options that are always set: https://github.com/LazyVim/LazyVim/blob/main/lua/lazyvim/config/options.lua
-- Add any additional options here
vim.opt.relativenumber = true
vim.opt.termguicolors = true


--- FILE: /home/james/.config/nvim/lua/plugins/all-themes.lua ---
return {
  -- Load all theme plugins but don't apply them
  -- This ensures all colorschemes are available for hot-reloading
  {
    "ribru17/bamboo.nvim",
    lazy = true,
    priority = 1000,
  },
  {
    "catppuccin/nvim",
    name = "catppuccin",
    lazy = true,
    priority = 1000,
  },
  {
    "sainnhe/everforest",
    lazy = true,
    priority = 1000,
  },
  {
    "kepano/flexoki-neovim",
    lazy = true,
    priority = 1000,
  },
  {
    "ellisonleao/gruvbox.nvim",
    lazy = true,
    priority = 1000,
  },
  {
    "rebelot/kanagawa.nvim",
    lazy = true,
    priority = 1000,
  },
  {
    "tahayvr/matteblack.nvim",
    lazy = true,
    priority = 1000,
  },
  {
    "loctvl842/monokai-pro.nvim",
    lazy = true,
    priority = 1000,
  },
  {
    "shaunsingh/nord.nvim",
    lazy = true,
    priority = 1000,
  },
  {
    "rose-pine/neovim",
    name = "rose-pine",
    lazy = true,
    priority = 1000,
  },
  {
    "folke/tokyonight.nvim",
    lazy = true,
    priority = 1000,
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/cmp.lua ---
return {
  -- === 1. FORCE nvim-cmp + disable blink.cmp ===
  {
    "hrsh7th/nvim-cmp",
    enabled = true,
    config = function()
      local cmp = require("cmp")
      local luasnip = require("luasnip")

      cmp.setup({
        snippet = {
          expand = function(args)
            luasnip.lsp_expand(args.body) -- Use luasnip for snippets
          end,
        },
        mapping = {
          ["<C-Space>"] = cmp.mapping.complete(), -- Trigger completion
          ["<CR>"] = cmp.mapping.confirm({ select = true }), -- Confirm selection
          ["<Tab>"] = cmp.mapping(function(fallback)
            if cmp.visible() then
              cmp.select_next_item()
            elseif luasnip.expand_or_jumpable() then
              luasnip.expand_or_jump()
            else
              fallback()
            end
          end, { "i", "s" }),
          ["<S-Tab>"] = cmp.mapping(function(fallback)
            if cmp.visible() then
              cmp.select_prev_item()
            elseif luasnip.jumpable(-1) then
              luasnip.jump(-1)
            else
              fallback()
            end
          end, { "i", "s" }),
        },
        sources = {
          { name = "nvim_lsp", priority = 1000 }, -- LSP completions
          { name = "luasnip", priority = 750 }, -- Snippets
          { name = "buffer", priority = 500 }, -- Buffer text
          { name = "path", priority = 250 }, -- Filesystem paths
        },
      })

      -- Ensure nvim_lsp for Java files
      cmp.setup.filetype("java", {
        sources = {
          { name = "nvim_lsp", priority = 1000 },
          { name = "luasnip", priority = 750 },
          { name = "buffer", priority = 500 },
          { name = "path", priority = 250 },
        },
      })
    end,
  },
  { "hrsh7th/cmp-nvim-lsp", enabled = true },
  { "hrsh7th/cmp-buffer", enabled = true },
  { "hrsh7th/cmp-path", enabled = true },
  { "saadparwaiz1/cmp_luasnip", enabled = true },
  { "Saghen/blink.cmp", enabled = false }, -- Disables blink completely
  -- === 2. Tell LazyVim to use nvim-cmp + luasnip ===
  {
    "L3MON4D3/LuaSnip",
    dependencies = { "rafamadriz/friendly-snippets" },
    config = function()
      require("luasnip.loaders.from_vscode").lazy_load()
      require("luasnip.loaders.from_lua").lazy_load({
        paths = { vim.fn.stdpath("config") .. "/lua/snippets" },
      })
    end,
  },
  -- === 3. Override LazyVim's luasnip extra to stop using blink ===
  {
    "lazyvim.plugins.extras.coding.luasnip",
    enabled = false, -- Disables the broken extra
  },
  -- === 4. Re-enable LazyVim's nvim-cmp extra (safe now) ===
  { import = "lazyvim.plugins.extras.coding.nvim-cmp" },
}


--- FILE: /home/james/.config/nvim/lua/plugins/codelens-autocmd.lua ---
return {
  {
    "neovim/nvim-lspconfig",
    opts = function()
      -- Refresh Code Lens only when entering a buffer, leaving insert mode, or saving.
      -- Removed "CursorHold" to eliminate flickering.
      vim.api.nvim_create_autocmd({ "BufEnter", "InsertLeave", "BufWritePost" }, {
        callback = function()
          vim.lsp.codelens.refresh({ bufnr = 0 })
        end,
      })

      -- Press 'gl' to click the code lens (Run test, etc)
      vim.keymap.set("n", "gl", vim.lsp.codelens.run, { desc = "Run Code Lens" })
    end,
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/colorizer.lua ---
return {
  "NvChad/nvim-colorizer.lua",
  config = function()
    require("colorizer").setup({
      user_default_options = {
        names = true, -- "Bold", "Red", etc.
        RGB = true, -- #RGB hex codes
        RRGGBB = true, -- #RRGGBB hex codes
        css = true, -- Enable all CSS features: rgb_fn, hsl_fn, etc.
        tailwind = true, -- Support tailwind colors
        mode = "background", -- "foreground", "background", or "virtualtext"
      },
    })
  end,
}


--- FILE: /home/james/.config/nvim/lua/plugins/dapui.lua ---
-- /home/james/.config/nvim/lua/plugins/dapui.lua
return {
  "rcarriga/nvim-dap-ui",
  -- This will merge with the default config from LazyVim
  opts = function(_, opts)
    -- By default, dap-ui opens all elements, including "console"
    -- We want to stop it from opening "console" so that
    -- output only appears in your Alacritty window.
    local elements = {
      "scopes",
      "breakpoints",
      "stacks",
      "watches",
      "repl", -- Keep the REPL (for typing debug commands)
      -- "console" is new, removed
    }

    -- Override the hooks that open the windows
    opts.hooks = {
      on_launch = function()
        require("dapui").open(elements)
      end,
      on_attach = function()
        require("dapui").open(elements)
      end,
    }
  end,
}


--- FILE: /home/james/.config/nvim/lua/plugins/disable-news-alert.lua ---
return {
	"LazyVim/LazyVim",
	opts = {
		news = {
			lazyvim = false,
			neovim = false,
		},
	},
}


--- FILE: /home/james/.config/nvim/lua/plugins/formatting.lua ---
return {
  -- We are modifying the existing conform.nvim plugin, which
  -- LazyVim already includes.
  {
    "stevearc/conform.nvim",
    opts = {
      -- This tells conform to use 'prettier' for these file types.
      formatters_by_ft = {
        python = { "black" },
        html = { "prettier" },
        css = { "prettier" },
        javascript = { "prettier" },
        -- You can add other file types here as you need them
      },
    },
    -- This 'keys' table is where we define our new, non-conflicting keymap
    keys = {
      {
        "<leader>F", -- Notice I'm using capital 'F' to avoid the conflict
        function()
          require("conform").format({ async = true, lsp_fallback = true })
        end,
        mode = "", -- This means it works in both Normal and Visual mode
        desc = "Format buffer or selection", -- This description will appear in your which-key menu!
      },
    },
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/lsp-java-skip.lua ---
return {
  {
    "neovim/nvim-lspconfig",
    opts = {
      servers = {
        -- Tell LazyVim's default LSP setup to skip 'jdtls'
        -- This lets our 'nvim-jdtls.lua' file take over
        jdtls = false,
      },
    },
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/mason-tools.lua ---
return {
  {
    "mason-org/mason.nvim", -- This line is correct
    -- This 'opts' function will merge with LazyVim's defaults
    opts = function(_, opts)
      -- 'opts.ensure_installed' is the list of tools Mason will install
      vim.list_extend(opts.ensure_installed, {
        -- Your list, now with all correct package names
        "debugpy",
        "groovy-language-server", -- Fixed: was "groovyls"
        "lua-language-server", -- Fixed: was "lua_ls"
        "jdtls",
        "json-lsp", -- Fixed: was "jsonls"
        "lemminx",
        "marksman",
        "yaml-language-server", -- Fixed: was "yamlls"
        "pyright",
        "black",
        "shfmt",
        "stylua",
        "java-debug-adapter",
        "java-test",
      })
    end,
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/noice.lua ---
return {
  {
    "folke/noice.nvim",
    opts = function(_, opts)
      -- Ensure routes table exists
      opts.routes = opts.routes or {}

      -- 1. SILENCE STARTUP NOTIFICATIONS (Top Right)
      table.insert(opts.routes, {
        filter = {
          event = "notify",
          any = {
            { find = "Found root_dir" },
            { find = "spring%-boot" },
            { find = "ftplugin: Executing" },
          },
        },
        opts = { skip = true },
      })

      -- 2. SILENCE TYPING/PROGRESS NOTIFICATIONS (Bottom Right)
      table.insert(opts.routes, {
        filter = {
          event = "lsp",
          kind = "progress",
          any = {
            { find = "Validate" },  -- Catches "Validate documents" AND "Validating diagnostics"
            { find = "Publish" },   -- Catches "Publish Diagnostics"
            { find = "Compiling" }, -- Catches "Compiling"
          },
        },
        opts = { skip = true },
      })
    end,
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/nvim-jdtls.lua ---
-- /home/james/.config/nvim/lua/plugins/nvim-jdtls.lua
return {
  "mfussenegger/nvim-jdtls",
  ft = "java",
  dependencies = {
    "neovim/nvim-lspconfig",
    "nvim-lua/plenary.nvim",
    "mfussenegger/nvim-dap",
    "hrsh7th/cmp-nvim-lsp",
  },
  -- The entire 'config' function has been removed.
  -- We will move all that logic to the new ftplugin file.
}


--- FILE: /home/james/.config/nvim/lua/plugins/omarchy-theme-hotreload.lua ---
return {
	{
		name = "theme-hotreload",
		dir = vim.fn.stdpath("config"),
		lazy = false,
		priority = 1000,
		config = function()
			local transparency_file = vim.fn.stdpath("config") .. "/plugin/after/transparency.lua"

			vim.api.nvim_create_autocmd("User", {
				pattern = "LazyReload",
				callback = function()
					-- Unload the theme module
					package.loaded["plugins.theme"] = nil

					vim.schedule(function()
						local ok, theme_spec = pcall(require, "plugins.theme")
						if not ok then
							return
						end

						-- Find the theme plugin and unload it
						local theme_plugin_name = nil
						for _, spec in ipairs(theme_spec) do
							if spec[1] and spec[1] ~= "LazyVim/LazyVim" then
								theme_plugin_name = spec.name or spec[1]
								break
							end
						end

						-- Clear all highlight groups before applying new theme
						vim.cmd("highlight clear")
						if vim.fn.exists("syntax_on") then
							vim.cmd("syntax reset")
						end

						-- Reset background to default so colorscheme can set it properly (light themes will set to light)
						vim.o.background = "dark"

						-- Unload theme plugin modules to force full reload
						if theme_plugin_name then
							local plugin = require("lazy.core.config").plugins[theme_plugin_name]
							if plugin then
								-- Unload all lua modules from the plugin directory
								local plugin_dir = plugin.dir .. "/lua"
								require("lazy.core.util").walkmods(plugin_dir, function(modname)
									package.loaded[modname] = nil
									package.preload[modname] = nil
								end)
							end
						end

						-- Find and apply the new colorscheme
						for _, spec in ipairs(theme_spec) do
							if spec[1] == "LazyVim/LazyVim" and spec.opts and spec.opts.colorscheme then
								local colorscheme = spec.opts.colorscheme

								-- Load the colorscheme plugin
								require("lazy.core.loader").colorscheme(colorscheme)

								vim.defer_fn(function()
									-- Apply the colorscheme (it will set background itself)
									pcall(vim.cmd.colorscheme, colorscheme)

									-- Force redraw to update all UI elements
									vim.cmd("redraw!")

									-- Reload transparency settings
									if vim.fn.filereadable(transparency_file) == 1 then
										vim.defer_fn(function()
											vim.cmd.source(transparency_file)

											-- Trigger UI updates for various plugins
											vim.api.nvim_exec_autocmds("ColorScheme", { modeline = false })
											vim.api.nvim_exec_autocmds("VimEnter", { modeline = false })

											-- Final redraw
											vim.cmd("redraw!")
										end, 5)
									end
								end, 5)

								break
							end
						end
					end)
				end,
			})
		end,
	},
}


--- FILE: /home/james/.config/nvim/lua/plugins/python.lua ---
-- ~/.config/nvim/lua/plugins/python.lua
return {
  -- 1. Treesitter (unchanged)
  {
    "nvim-treesitter/nvim-treesitter",
    opts = function(_, opts)
      vim.list_extend(opts.ensure_installed, { "python", "requirements" })
    end,
  },

  -- 2. Mason: LSP, formatter, linter, debugger
  {
    "mason-org/mason.nvim",
    opts = function(_, opts)
      vim.list_extend(opts.ensure_installed, {
        "pyright", -- LSP (unchanged)
        "ruff", -- CHANGED: was "ruff-lsp"
        "black", -- Formatter (fallback, unchanged)
        "debugpy", -- Debugger (DAP, unchanged)
        "mypy", -- Type checker (unchanged)
      })
    end,
  },

  -- 3. LSP Config
  {
    "neovim/nvim-lspconfig",
    opts = function(_, opts)
      vim.tbl_deep_extend("force", opts.servers or {}, {
        pyright = {}, -- unchanged
        ruff = {}, -- CHANGED: was "ruff" (but lspconfig uses "ruff" for the new server; old was "ruff_lsp")
      })
    end,
  },

  -- 4. Formatter (conform.nvim) - UPDATED for ruff's integrated formatter
  {
    "stevearc/conform.nvim",
    opts = function(_, opts)
      opts.formatters_by_ft = vim.tbl_deep_extend("force", opts.formatters_by_ft or {}, {
        python = { "ruff_format", "black" }, -- UNCHANGED: ruff_format works with new ruff binary
      })
    end,
  },

  -- 5. Linting (nvim-lint) - mypy (unchanged)
  {
    "mfussenegger/nvim-lint",
    opts = function(_, opts)
      opts.linters_by_ft = vim.tbl_deep_extend("force", opts.linters_by_ft or {}, {
        python = { "mypy" },
      })
    end,
  },

  -- 6. Debugger (DAP) - unchanged
  {
    "mfussenegger/nvim-dap-python",
    ft = "python",
    dependencies = { "mfussenegger/nvim-dap" },
    config = function()
      require("dap-python").setup("python") -- uses debugpy from Mason
      -- Optional: test runner
      require("dap-python").test_runner = "pytest"
    end,
  },

  -- 7. Virtual env auto-detect (unchanged)
  {
    "linux-cultist/venv-selector.nvim",
    dependencies = { "neovim/nvim-lspconfig" },
    ft = "python",
    opts = {
      name = { "venv", ".venv" },
      auto_refresh = true,
    },
  },

  -- 8. Jupyter / REPL (unchanged, assuming you fixed the build)
  {
    "goerz/jupytext.vim",
    ft = { "python", "ipynb" },
    build = function()
      -- Your fixed build logic here (pipx, etc.)
    end,
    config = function()
      vim.g.jupytext_fmt = "py:percent" -- default format
      vim.g.jupytext_command = "jupytext" -- ensure it finds the binary
    end,
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/rainbow-brackets.lua ---
return {
  "HiPhish/rainbow-delimiters.nvim",
  dependencies = "nvim-treesitter/nvim-treesitter",
  config = function()
    local rainbow_delimiters = require("rainbow-delimiters")

    vim.g.rainbow_delimiters = {
      strategy = {
        [""] = rainbow_delimiters.strategy["global"],
        vim = rainbow_delimiters.strategy["local"],
      },
      query = {
        [""] = "rainbow-delimiters",
        lua = "rainbow-blocks",
      },
      highlight = {
        "RainbowDelimiterRed",
        "RainbowDelimiterYellow",
        "RainbowDelimiterBlue",
        "RainbowDelimiterOrange",
        "RainbowDelimiterGreen",
        "RainbowDelimiterViolet",
        "RainbowDelimiterCyan",
      },
    }
  end,
}


--- FILE: /home/james/.config/nvim/lua/plugins/rest-nvim.lua ---
return {
  "rest-nvim/rest.nvim",
  dependencies = {
    "nvim-treesitter/nvim-treesitter",
    opts = function(_, opts)
      opts.ensure_installed = opts.ensure_installed or {}
      table.insert(opts.ensure_installed, "http")
    end,
  },
  -- Add an init function to set global options
  init = function()
    -- This is where you can override the defaults
    -- See the "Default configuration" section of the README for options
    vim.g.rest_nvim = {
      request = {
        -- Example: skip SSL verification if needed
        -- skip_ssl_verification = true,
      },
      response = {
        hooks = {
          -- Example: disable formatting the response body
          -- format = false,
        },
      },
      -- ... other settings
    }
  end,
  keys = {
    {
      "<leader>r",
      desc = "+rest",
    },
    {
      "<leader>ro",
      ":Rest open<CR>",
      mode = "n",
      desc = "Rest: Open Result pane",
    },
    {
      "<leader>rr", -- Key combination
      ":Rest run<CR>", -- Command to run
      mode = "n", -- Normal mode
      desc = "Rest: Run request under cursor", -- Description for which-key
    },
    {
      "<leader>rl",
      ":Rest last<CR>",
      mode = "n",
      desc = "Rest: Run last request",
    },
    {
      "<leader>rm",
      ":Rest logs<CR>",
      mode = "n",
      desc = "Rest: Edit logs file",
    },
    {
      "<leader>rc",
      ":Rest cookies<CR>",
      mode = "n",
      desc = "Rest: Edit cookies file",
    },
    {
      "<leader>rs",
      ":Rest env show<CR>",
      mode = "n",
      desc = "Show dotenv file registered to current .http file",
    },
    {
      "<leader>re",
      ":Rest env select",
      mode = "n",
      desc = "Select and register .env file with vim.ui.select()",
    },
    -- Add more keybindings as needed
    -- {
    --   "<leader>ro",
    --   ":Rest open<CR>",
    --   mode = "n",
    --   desc = "Rest: Open result pane",
    -- },
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/snacks-animated-scrolling-off.lua ---
return {
	"folke/snacks.nvim",
	opts = {
		scroll = {
			enabled = false, -- Disable scrolling animations
		},
	},
}


--- FILE: /home/james/.config/nvim/lua/plugins/spring-boot.lua ---
return {
  {
    "JavaHello/spring-boot.nvim",
    ft = { "java", "yaml", "jproperties" },
    dependencies = {
      "mfussenegger/nvim-jdtls", -- or your preferred Java LSP setup
    },
    opts = {},
    config = function()
      -- This is REQUIRED to enable Spring LSP features
      require("spring_boot").init_lsp_commands()
    end,
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/syntaxpresson.lua ---
return {
  {
    "syntaxpresso/syntaxpresso.nvim",
    -- Optimization: Only load this plugin when editing Java files
    ft = "java",

    -- Configuration (passed to require("syntaxpresso").setup)
    opts = {
      -- Custom keybinding for the main menu (default is <leader>cj)
      keymap = "<leader>cj",

      -- Auto-update settings
      auto_update = {
        enabled = true,
        frequency = "always",
        prompt = false,
      },
    },

    -- Keybindings (Lazy-load the plugin when these keys are pressed)
    keys = {
      -- Main Menu
      { "<leader>cj", desc = "Syntaxpresso Menu" },

      -- Direct Commands
      { "<leader>je", "<cmd>SyntaxpressoCreateJpaEntity<CR>",          desc = "Create JPA Entity" },
      { "<leader>jf", "<cmd>SyntaxpressoCreateEntityField<CR>",        desc = "Create JPA Field" },
      { "<leader>jr", "<cmd>SyntaxpressoCreateEntityRelationship<CR>", desc = "Create Relationship" },
      { "<leader>jR", "<cmd>SyntaxpressoCreateJpaRepository<CR>",      desc = "Create Repository" },
    },
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/theme.lua ---
return {
  {
    "kepano/flexoki-neovim",
    priority = 1000,
  },
  {
    "LazyVim/LazyVim",
    opts = {
      colorscheme = "flexoki-light",
    },
  },
}


--- FILE: /home/james/.config/nvim/lua/plugins/web-dev.lua ---
return {
  -- 1. Add web-dev parsers to nvim-treesitter
  {
    "nvim-treesitter/nvim-treesitter",
    opts = function(_, opts)
      vim.list_extend(opts.ensure_installed, {
        "javascript", "typescript", "tsx", "css", "html", "json",
      })
    end,
  },

  -- 2. Add web-dev tools to Mason
  {
    "mason-org/mason.nvim",
    opts = function(_, opts)
      vim.list_extend(opts.ensure_installed, {
        -- CHANGE 1: Replaced "typescript-language-server" with "vtsls"
        "vtsls",
        "css-lsp",
        "html-lsp",
        "eslint-lsp",
        "prettierd",
        "emmet-language-server",
      })
    end,
  },

  -- 3. Add web-dev language servers to nvim-lspconfig
  {
    "neovim/nvim-lspconfig",
    opts = function(_, opts)
      vim.tbl_deep_extend("force", opts.servers or {}, {
        -- CHANGE 2: Removed tsserver/ts_ls and added vtsls configuration
        vtsls = {
          -- This ensures the server knows it's a JS project
          single_file_support = true,
          settings = {
            vtsls = {
              autoUseWorkspaceTsdk = true,
              experimental = {
                completion = {
                  enableServerSideFuzzyMatch = true,
                },
              },
            },
            typescript = {
              updateImportsOnFileMove = { enabled = "always" },
              -- === NEW CODE LENS SETTINGS START ===
              referencesCodeLens = { enabled = true, showOnAllFunctions = true },
              implementationsCodeLens = { enabled = true },
              -- === NEW CODE LENS SETTINGS END ===
              inlayHints = {
                parameterNames = { enabled = "literals" },
                parameterTypes = { enabled = true },
              },
            },
          },
        },
        cssls = {},
        html = {},
        eslint = {},
        emmet_language_server = {
          filetypes = {
            "css", "html", "javascriptreact", "typescriptreact",
            "less", "sass", "scss", "vue", "svelte"
          },
        },
      })
    end,
  },

  -- 4. Add prettierd as the formatter
  {
    "stevearc/conform.nvim",
    opts = function(_, opts)
      opts.formatters_by_ft = vim.tbl_deep_extend("force", opts.formatters_by_ft or {}, {
        javascript = { "prettierd" },
        typescript = { "prettierd" },
        javascriptreact = { "prettierd" },
        typescriptreact = { "prettierd" },
        css = { "prettierd" },
        html = { "prettierd" },
        json = { "prettierd" },
      })
    end,
  },
}


--- FILE: /home/james/.config/nvim/lua/snippets/html.lua ---
local ls = require("luasnip")
local s = ls.snippet
local t = ls.text_node
local i = ls.insert_node

return {
  s("lorem", {
    t({
      "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod ",
      "tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim ",
      "veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea ",
      "commodo consequat.",
    }),
    i(0),
  }),
}


--- FILE: /home/james/.config/nvim/plugin/after/transparency.lua ---
-- transparent background
vim.api.nvim_set_hl(0, "Normal", { bg = "none" })
vim.api.nvim_set_hl(0, "NormalFloat", { bg = "none" })
vim.api.nvim_set_hl(0, "FloatBorder", { bg = "none" })
vim.api.nvim_set_hl(0, "Pmenu", { bg = "none" })
vim.api.nvim_set_hl(0, "Terminal", { bg = "none" })
vim.api.nvim_set_hl(0, "EndOfBuffer", { bg = "none" })
vim.api.nvim_set_hl(0, "FoldColumn", { bg = "none" })
vim.api.nvim_set_hl(0, "Folded", { bg = "none" })
vim.api.nvim_set_hl(0, "SignColumn", { bg = "none" })
vim.api.nvim_set_hl(0, "NormalNC", { bg = "none" })
vim.api.nvim_set_hl(0, "WhichKeyFloat", { bg = "none" })
vim.api.nvim_set_hl(0, "TelescopeBorder", { bg = "none" })
vim.api.nvim_set_hl(0, "TelescopeNormal", { bg = "none" })
vim.api.nvim_set_hl(0, "TelescopePromptBorder", { bg = "none" })
vim.api.nvim_set_hl(0, "TelescopePromptTitle", { bg = "none" })

-- transparent background for neotree
vim.api.nvim_set_hl(0, "NeoTreeNormal", { bg = "none" })
vim.api.nvim_set_hl(0, "NeoTreeNormalNC", { bg = "none" })
vim.api.nvim_set_hl(0, "NeoTreeVertSplit", { bg = "none" })
vim.api.nvim_set_hl(0, "NeoTreeWinSeparator", { bg = "none" })
vim.api.nvim_set_hl(0, "NeoTreeEndOfBuffer", { bg = "none" })

-- transparent background for nvim-tree
vim.api.nvim_set_hl(0, "NvimTreeNormal", { bg = "none" })
vim.api.nvim_set_hl(0, "NvimTreeVertSplit", { bg = "none" })
vim.api.nvim_set_hl(0, "NvimTreeEndOfBuffer", { bg = "none" })

-- transparent notify background
vim.api.nvim_set_hl(0, "NotifyINFOBody", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyERRORBody", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyWARNBody", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyTRACEBody", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyDEBUGBody", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyINFOTitle", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyERRORTitle", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyWARNTitle", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyTRACETitle", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyDEBUGTitle", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyINFOBorder", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyERRORBorder", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyWARNBorder", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyTRACEBorder", { bg = "none" })
vim.api.nvim_set_hl(0, "NotifyDEBUGBorder", { bg = "none" })
